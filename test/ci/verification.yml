compile:hardware_emu:
    stage: compile
    extends: .simulation
    tags:
        - dv
    rules:
      - if: '$CI_SKIP_SIMULATION == "true"'
        when: never
      - when: always
    script:
        - cd ${CI_PROJECT_DIR}/tools
        - source install_verilator.sh
        - source ${CI_PROJECT_DIR}/test/ci/setup.sh
        - cd ${CI_PROJECT_DIR}/test/verilator
        - source compile_sauria.sh
    artifacts:
        expire_in: 1 days
        when: on_success
        paths:
            - ${CI_PROJECT_DIR}/test/verilator/verilator.log
            - ${CI_PROJECT_DIR}/test/verilator/Test-Sim
            - ${CI_PROJECT_DIR}/tools/verilator/*

test:debug_test:
    stage: test
    dependencies:
      - compile:hardware_emu
    extends: .simulation
    tags:
        - dv
    rules:
      - if: '$CI_SKIP_SIMULATION == "true"'
        when: never
      - when: on_success
    script:
        - source ${CI_PROJECT_DIR}/test/ci/setup.sh
        - cd ${CI_PROJECT_DIR}/Python
        - source install_venv.sh
        - cd scripts
        - python run_verif_test.py --test_type debug_test --assert_no_errors

test:bmk_small:
    stage: test
    dependencies:
      - compile:hardware_emu
    extends: .simulation
    tags:
        - dv
    rules:
      - if: '$CI_SKIP_SIMULATION == "true"'
        when: never
      - when: on_success
    script:
        - source ${CI_PROJECT_DIR}/test/ci/setup.sh
        - cd ${CI_PROJECT_DIR}/Python
        - source install_venv.sh
        - cd scripts
        - python run_verif_test.py --test_type bmk_small --assert_no_errors

test:conv_validation:
    stage: test
    dependencies:
      - compile:hardware_emu
    extends: .simulation
    tags:
        - dv
    rules:
      - if: '$CI_SKIP_SIMULATION == "true"'
        when: never
      - when: on_success
    script:
        - source ${CI_PROJECT_DIR}/test/ci/setup.sh
        - cd ${CI_PROJECT_DIR}/Python
        - source install_venv.sh
        - cd scripts
        - python run_verif_test.py --test_type conv_validation --assert_no_errors